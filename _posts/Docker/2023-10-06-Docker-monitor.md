---
title: 6. 컨테이너 모니터링
author: maruduke
date: 2023-10-06 14:10:00 +0800
categories: [Docker]
tags: [docker]
---

## 컨테이너화된 애플리케이션에서 사용되는 모니터링 기술 스택

컨테이너화된 애플리케이션 환경은 역동적이다. 애플리케이션은 수십 개에서 수백 개에 이르는 컨테이너에 걸쳐 실행되고, 컨테이너는 플랫폼에 의해 끊임없이 생성됐다가 삭제되기를 반복한다.

이런 환경에서 컨테이너를 다룰 수 있으며 컨테이너 플랫폼과 연동해 정적인 컨테이너 혹은 IP주소 목록 없이도 실행중인 애플리케이션을 속속들이 들여볼 수 있는 도구를 갖춘 모니터링 방식이 필요하다. 프로메테우스는 바로 이런 기능을 제공하는 오픈 소스 도구이다.

프로메테우스를 사용하면 모니터링의 일관성이 확보된다. 모든 애플리케이션에서 똑같이 구성된 측정값이 나오기 때문에 어떤 애플리케이션이든 똑같은 표준적인 형태로 모니터링할 수 있다.

프로메테우스의 또다른 장점은 도커 엔진의 측정값도 같은 형식으로 추출할 수 있다는 점이다. 이를 통해 컨테이너 플랫폼에서 벌어지는 일도 파악할 수 있다. 이 기능을 사용하려면 도커 엔진 설정에서 프로메테우스 측정 기능을 명시적으로 활성화해야 한다.
설정 파일을 열고 다음 두 값을 추가하라

```json
"metrics-addr" : "0.0.0.0:9323",
"experimental": true
```

![Desktop View](/assets/img/Docker/6/1.png)

이 설정을 추가하면 포트 9323번을 통해 측정값이 공개된다.
http://localhost:9323/metrics에서 도커 엔진의 상태 정보를 볼 수 있다.
해당 프로메테우스 포맷은 이름과 값의 쌍 형태로 표현되는 간단한 텍스트 기반 포맷으로 되어 있다.

> 프로메테우스를 컨테이너에서 실행해 현재 도커를 실행 중인 컴퓨터의 정보를 수집하려면 로컬 컴퓨터의 IP주소를 확인해야 한다. 컨테이너는 자신을 실행 중인 서버의 IP주소를 알 수 없으므로 이 정보를 환경 변수 형태로 직접 전달

```console
# 로컬 컴퓨터의 IP주소를 확인해 환경 변수로 정의(리눅스)
$ hostIP=$(ip route get 1 | awk '{print $NF;exit}')

# 환경 변수로 로컬 컴퓨터의 IP 주소를 전달해 컨테이너를 실행
$ docker container run -e DOCKER_HOST=$hostIP -d -p 9090:9090 diamol/prometheus:2.13.1
```

웹 브라우저에서 http://localhost:9090에 접근하여 프로메테우스의 웹 인터페이스를 통해 상태를 확인할 수 있다.

## 측정값 시각화를 위한 그라파나 컨테이너 실행

